<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Glowing</title>
  <link rel="shortcut icon" href="../../favicon.svg" type="image/svg+xml">
  <link href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --green: #5e8b61;
      --light-green: #7ba97d;
      --bg: #f5f5f5;
      --white: #fff;
      --gray: #666;
      --black: #000;
    }

    body {
      font-family: 'Urbanist', sans-serif;
      background: linear-gradient(135deg, #f5f5f5 0%, #e8f5e9 100%);
      color: var(--gray);
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, var(--green), var(--light-green));
      color: white;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header h1 {
      font-size: 24px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--green), var(--light-green));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(94, 139, 97, 0.3);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #3b82f6, #60a5fa);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ef4444, #f87171);
      color: white;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 14px;
    }

    /* Layout */
    .container {
      display: flex;
      max-width: 1600px;
      margin: 30px auto;
      gap: 30px;
      padding: 0 30px;
    }

    /* Sidebar */
    .sidebar {
      width: 250px;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      height: fit-content;
      position: sticky;
      top: 100px;
    }

    .sidebar-link {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      border-radius: 8px;
      color: var(--gray);
      text-decoration: none;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .sidebar-link:hover {
      background: rgba(94, 139, 97, 0.1);
    }

    .sidebar-link.active {
      background: linear-gradient(135deg, var(--green), var(--light-green));
      color: white;
    }

    /* Main Content */
    .main-content {
      flex: 1;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    /* Stats */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      border-left: 4px solid var(--green);
      transition: all 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 10px;
    }

    .stat-icon {
      width: 45px;
      height: 45px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
    }

    .stat-icon.green {
      background: #d1fae5;
      color: #059669;
    }

    .stat-icon.blue {
      background: #dbeafe;
      color: #2563eb;
    }

    .stat-icon.purple {
      background: #e0e7ff;
      color: #6366f1;
    }

    .stat-icon.orange {
      background: #fed7aa;
      color: #ea580c;
    }

    .stat-label {
      font-size: 12px;
      text-transform: uppercase;
      color: var(--gray);
      font-weight: 600;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--black);
    }

    .stat-change {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 12px;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 6px;
      margin-top: 8px;
    }

    .stat-change.up {
      background: #d1fae5;
      color: #059669;
    }

    .stat-change.down {
      background: #fee2e2;
      color: #dc2626;
    }

    /* Card */
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 30px;
    }

    .card-header {
      padding: 20px;
      border-bottom: 2px solid #f5f5f5;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .card-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--black);
    }

    .card-body {
      padding: 20px;
    }

    /* Chart Container */
    .chart-container {
      position: relative;
      height: 300px;
      margin: 20px 0;
    }

    /* Grid Layouts */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    /* Activity Feed */
    .activity-item {
      display: flex;
      gap: 15px;
      padding: 15px 0;
      border-bottom: 1px solid #f5f5f5;
      transition: background 0.3s;
    }

    .activity-item:hover {
      background: rgba(94, 139, 97, 0.03);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 18px;
    }

    .activity-icon.green {
      background: #d1fae5;
      color: #059669;
    }

    .activity-icon.blue {
      background: #dbeafe;
      color: #2563eb;
    }

    .activity-icon.purple {
      background: #e0e7ff;
      color: #6366f1;
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-weight: 600;
      color: var(--black);
      margin-bottom: 3px;
      font-size: 14px;
    }

    .activity-description {
      font-size: 13px;
      color: var(--gray);
    }

    .activity-time {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 3px;
    }

    /* Notification Alert */
    .alert {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
    }

    .alert-warning {
      background: #fef3c7;
      color: #92400e;
      border-left: 3px solid #f59e0b;
    }

    .alert-danger {
      background: #fee2e2;
      color: #991b1b;
      border-left: 3px solid #dc2626;
    }

    .alert-info {
      background: #dbeafe;
      color: #1e40af;
      border-left: 3px solid #3b82f6;
    }

    /* Table */
    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th {
      text-align: left;
      padding: 12px;
      background: #f5f5f5;
      font-size: 12px;
      text-transform: uppercase;
      font-weight: 700;
    }

    .table td {
      padding: 12px;
      border-bottom: 1px solid #f5f5f5;
    }

    .table tr:hover {
      background: rgba(94, 139, 97, 0.05);
    }

    /* Form */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .form-group.full {
      grid-column: 1 / -1;
    }

    label {
      font-weight: 600;
      color: var(--black);
      font-size: 14px;
    }

    input,
    select,
    textarea {
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-family: 'Urbanist', sans-serif;
      font-size: 14px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--green);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    .search-box {
      position: relative;
      max-width: 300px;
    }

    .search-box input {
      width: 100%;
      padding-right: 40px;
    }

    .search-box ion-icon {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 20px;
      color: var(--gray);
    }

    /* Badge */
    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
    }

    .badge-admin {
      background: #8b5cf6;
      color: white;
    }

    .badge-user {
      background: #3b82f6;
      color: white;
    }

    .badge-pending {
      background: #f59e0b;
      color: white;
    }

    .badge-processing {
      background: #3b82f6;
      color: white;
    }

    .badge-shipped {
      background: #8b5cf6;
      color: white;
    }

    .badge-delivered {
      background: #10b981;
      color: white;
    }

    .badge-cancelled {
      background: #ef4444;
      color: white;
    }

    /* Product Image */
    .product-img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 8px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--green);
      color: white;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    /* Top Product Item */
    .top-product-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #f5f5f5;
    }

    .top-product-item:last-child {
      border-bottom: none;
    }

    .product-info-inline {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .product-rank {
      font-size: 18px;
      font-weight: 700;
      color: #d1d5db;
      width: 30px;
    }

    .product-stats {
      text-align: right;
    }

    .product-revenue {
      font-weight: 700;
      color: var(--green);
    }

    .product-sales {
      font-size: 12px;
      color: var(--gray);
    }

    /* Mobile */
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        padding: 15px;
      }

      .sidebar {
        width: 100%;
        position: static;
      }

      .stats {
        grid-template-columns: 1fr;
      }

      .grid-2,
      .grid-3 {
        grid-template-columns: 1fr;
      }

      .table {
        font-size: 12px;
      }

      .table th,
      .table td {
        padding: 8px;
      }
    }

    /* Notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      background: var(--green);
      color: white;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      animation: slideIn 0.3s;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
  </style>
</head>

<body>

  <!-- Header -->
  <div class="header">
    <h1>ðŸŒ¿ Glowing Admin</h1>
    <button class="btn btn-primary btn-sm" onclick="logout()">
      <ion-icon name="log-out-outline"></ion-icon>
      Logout
    </button>
  </div>

  <!-- Container -->
  <div class="container">

    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-link active" onclick="showSection('dashboard')">
        <ion-icon name="grid-outline"></ion-icon>
        Dashboard
      </div>
      <div class="sidebar-link" onclick="showSection('users')">
        <ion-icon name="people-outline"></ion-icon>
        Users
      </div>
      <div class="sidebar-link" onclick="showSection('products')">
        <ion-icon name="cube-outline"></ion-icon>
        Products
      </div>
      <div class="sidebar-link" onclick="showSection('orders')">
        <ion-icon name="bag-outline"></ion-icon>
        Orders
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">

      <!-- Dashboard Section -->
      <div id="dashboard" class="section active">
        <!-- Stats Grid -->
        <div class="stats">
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Today's Sales</div>
                <div class="stat-value" id="todaySales">AED 0</div>
                <div class="stat-change up">
                  <ion-icon name="trending-up"></ion-icon>
                  <span>+12.5%</span>
                </div>
              </div>
              <div class="stat-icon green">
                <ion-icon name="cash-outline"></ion-icon>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Total Orders</div>
                <div class="stat-value" id="totalOrders">0</div>
                <div class="stat-change up">
                  <ion-icon name="trending-up"></ion-icon>
                  <span>+8.2%</span>
                </div>
              </div>
              <div class="stat-icon blue">
                <ion-icon name="receipt-outline"></ion-icon>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Total Customers</div>
                <div class="stat-value" id="totalCustomers">0</div>
                <div class="stat-change up">
                  <ion-icon name="trending-up"></ion-icon>
                  <span>+23.1%</span>
                </div>
              </div>
              <div class="stat-icon purple">
                <ion-icon name="people-outline"></ion-icon>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Low Stock</div>
                <div class="stat-value" id="lowStockItems">0</div>
                <div class="stat-change down">
                  <ion-icon name="alert-circle-outline"></ion-icon>
                  <span>Alert</span>
                </div>
              </div>
              <div class="stat-icon orange">
                <ion-icon name="warning-outline"></ion-icon>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Monthly Revenue</div>
                <div class="stat-value" id="monthlyRevenue">AED 0</div>
                <div class="stat-change up">
                  <ion-icon name="trending-up"></ion-icon>
                  <span>+15.3%</span>
                </div>
              </div>
              <div class="stat-icon green">
                <ion-icon name="trending-up-outline"></ion-icon>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Avg Order Value</div>
                <div class="stat-value" id="avgOrderValue">AED 0</div>
                <div class="stat-change up">
                  <ion-icon name="trending-up"></ion-icon>
                  <span>+5.7%</span>
                </div>
              </div>
              <div class="stat-icon blue">
                <ion-icon name="calculator-outline"></ion-icon>
              </div>
            </div>
          </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid-2">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Revenue Overview</h3>
              <select class="btn btn-sm" style="background: #f5f5f5; color: var(--black);">
                <option>Last 7 days</option>
                <option>Last 30 days</option>
                <option>Last 3 months</option>
              </select>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="revenueChart"></canvas>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Orders by Status</h3>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="statusChart"></canvas>
              </div>
            </div>
          </div>
        </div>

        <!-- Activity & Notifications -->
        <div class="grid-3">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Recent Activity</h3>
            </div>
            <div class="card-body" id="recentActivity"></div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Notifications</h3>
            </div>
            <div class="card-body" id="notificationsPanel"></div>
          </div>
        </div>

        <!-- Sales by Category -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Sales by Category</h3>
          </div>
          <div class="card-body">
            <div class="chart-container">
              <canvas id="categoryChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Top Selling Products -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Top Selling Products</h3>
            <button class="btn btn-secondary btn-sm" onclick="showSection('products')">View All</button>
          </div>
          <div class="card-body" id="topProductsList"></div>
        </div>

        <!-- Recent Orders Table -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Recent Orders</h3>
            <button class="btn btn-secondary btn-sm" onclick="showSection('orders')">View All</button>
          </div>
          <div class="card-body" id="recentOrdersTable"></div>
        </div>
      </div>

      <!-- Users Section -->
      <div id="users" class="section">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">User Management</h2>
            <div style="display: flex; gap: 10px;">
              <div class="search-box">
                <input type="text" placeholder="Search users..." id="userSearch" onkeyup="filterUsers()">
                <ion-icon name="search-outline"></ion-icon>
              </div>
              <button class="btn btn-primary btn-sm" onclick="showAddUser()">
                <ion-icon name="add-outline"></ion-icon>
                Add User
              </button>
            </div>
          </div>
          <div class="card-body">
            <div id="usersList"></div>
            <div id="addUserForm" style="display:none;">
              <h3 style="margin-bottom: 20px;">Add New User</h3>
              <form onsubmit="saveUser(event)">
                <div class="form-grid">
                  <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="userName" required>
                  </div>
                  <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="userEmail" required>
                  </div>
                  <div class="form-group">
                    <label>Role *</label>
                    <select id="userRole" required>
                      <option value="user">User</option>
                      <option value="admin">Admin</option>
                    </select>
                  </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                  <button type="submit" class="btn btn-primary">Save User</button>
                  <button type="button" class="btn btn-secondary" onclick="cancelUserForm()">Cancel</button>
                </div>
              </form>
            </div>
            <div id="editUserForm" style="display:none;">
              <h3 style="margin-bottom: 20px;">Edit User</h3>
              <form onsubmit="updateUser(event)">
                <input type="hidden" id="editUserId">
                <div class="form-grid">
                  <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="editUserName" required>
                  </div>
                  <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="editUserEmail" required>
                  </div>
                  <div class="form-group">
                    <label>Role *</label>
                    <select id="editUserRole" required>
                      <option value="user">User</option>
                      <option value="admin">Admin</option>
                    </select>
                  </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                  <button type="submit" class="btn btn-primary">Update User</button>
                  <button type="button" class="btn btn-secondary" onclick="cancelEditUser()">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Products Section -->
      <div id="products" class="section">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Product Management</h2>
            <div style="display: flex; gap: 10px;">
              <div class="search-box">
                <input type="text" placeholder="Search products..." id="productSearch" onkeyup="filterProducts()">
                <ion-icon name="search-outline"></ion-icon>
              </div>
              <button class="btn btn-primary btn-sm" onclick="showAddProduct()">
                <ion-icon name="add-outline"></ion-icon>
                Add Product
              </button>
            </div>
          </div>
          <div class="card-body">
            <div id="productsList"></div>
            <div id="addProductForm" style="display:none;">
              <h3 style="margin-bottom: 20px;">Add New Product</h3>
              <form onsubmit="saveProduct(event)">
                <div class="form-grid">
                  <div class="form-group">
                    <label>Name *</label>
                    <input type="text" id="productName" required>
                  </div>
                  <div class="form-group">
                    <label>Price (AED) *</label>
                    <input type="number" step="0.01" id="productPrice" required>
                  </div>
                  <div class="form-group">
                    <label>Original Price</label>
                    <input type="number" step="0.01" id="productOriginalPrice">
                  </div>
                  <div class="form-group">
                    <label>Category *</label>
                    <select id="productCategory" required>
                      <option value="skincare">Skincare</option>
                      <option value="haircare">Haircare</option>
                      <option value="perfume">Perfume</option>
                      <option value="accessories">Accessories</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Brand *</label>
                    <select id="productBrand" required>
                      <option value="glowing">Glowing</option>
                      <option value="bio-essence">Bio-Essence</option>
                      <option value="natural-glow">Natural Glow</option>
                      <option value="pure-skin">Pure Skin</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label>Stock *</label>
                    <input type="number" id="productStock" required>
                  </div>
                  <div class="form-group">
                    <label>Rating (1-5)</label>
                    <input type="number" min="1" max="5" id="productRating" value="5">
                  </div>
                  <div class="form-group">
                    <label>Reviews</label>
                    <input type="number" id="productReviews" value="0">
                  </div>
                  <div class="form-group full">
                    <label>Image URL *</label>
                    <input type="text" id="productImage" required>
                  </div>
                  <div class="form-group full">
                    <label>Description</label>
                    <textarea id="productDescription"></textarea>
                  </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                  <button type="submit" class="btn btn-primary">Save Product</button>
                  <button type="button" class="btn btn-secondary" onclick="cancelProductForm()">Cancel</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Orders Section -->
      <div id="orders" class="section">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Order Management</h2>
            <div class="search-box">
              <input type="text" placeholder="Search orders..." id="orderSearch" onkeyup="filterOrders()">
              <ion-icon name="search-outline"></ion-icon>
            </div>
          </div>
          <div class="card-body">
            <div id="ordersList"></div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let users = JSON.parse(localStorage.getItem('adminUsers')) || [
      { id: 1, name: 'John Doe', email: 'john@example.com', role: 'admin', joined: '2024-01-15' },
      { id: 2, name: 'Sultan Al-Amiri', email: 'sultan@example.com', role: 'user', joined: '2024-02-10' },
      { id: 3, name: 'Michael Chen', email: 'michael@example.com', role: 'user', joined: '2024-02-15' }
    ];

    // ðŸ”¥ CRITICAL: Force load from localStorage on page load
    const savedAdminUsers = JSON.parse(localStorage.getItem('adminUsers')) || [];
    if (savedAdminUsers.length > users.length) {
      console.log('ðŸ“¥ Loading users from localStorage');
      users = savedAdminUsers;
    }

    const DEFAULT_PRODUCTS = [
      {
        id: 13,
        name: "Vitamin C Brightening Serum",
        price: 45.00,
        originalPrice: 55.00,
        image: "../assets/images/product-01.jpg",
        category: "skincare",
        brand: "glowing",
        rating: 5,
        reviews: 2847,
        stock: 15,
        description: "A powerful vitamin C serum that brightens and evens skin tone while providing antioxidant protection.",
        isNew: true,
        onSale: true
      },
      {
        id: 14,
        name: "Hydrating Facial Cleanser",
        price: 28.00,
        image: "../assets/images/product-02.jpg",
        category: "skincare",
        brand: "glowing",
        rating: 5,
        reviews: 1923,
        stock: 8,
        description: "Gentle yet effective cleanser that removes impurities while maintaining skin's natural moisture barrier."
      },
      {
        id: 15,
        name: "Nourishing Hair Oil",
        price: 32.00,
        originalPrice: 40.00,
        image: "../assets/images/product-03.jpg",
        category: "haircare",
        brand: "bio-essence",
        rating: 4,
        reviews: 1456,
        stock: 23,
        description: "Luxurious hair oil blend that strengthens, shines, and protects hair from damage.",
        onSale: true
      },
      {
        id: 16,
        name: "Rose Gold Perfume",
        price: 89.00,
        image: "../assets/images/product-04.jpg",
        category: "perfume",
        brand: "natural-glow",
        rating: 5,
        reviews: 892,
        stock: 12,
        description: "Elegant floral fragrance with notes of rose, gold amber, and white musk.",
        isNew: true
      },
      {
        id: 17,
        name: "Anti-Aging Night Cream",
        price: 67.00,
        originalPrice: 85.00,
        image: "../assets/images/product-05.jpg",
        category: "skincare",
        brand: "glowing",
        rating: 5,
        reviews: 3421,
        stock: 5,
        description: "Rich night cream with retinol and peptides to reduce fine lines and improve skin texture.",
        onSale: true
      },
      {
        id: 18,
        name: "Silk Hair Scrunchies Set",
        price: 15.00,
        image: "../assets/images/product-06.jpg",
        category: "accessories",
        brand: "pure-skin",
        rating: 4,
        reviews: 567,
        stock: 45,
        description: "Set of 3 premium silk scrunchies that protect hair from breakage and reduce frizz."
      },
      {
        id: 19,
        name: "Exfoliating Body Scrub",
        price: 38.00,
        image: "../assets/images/product-07.jpg",
        category: "skincare",
        brand: "glowing",
        rating: 5,
        reviews: 1789,
        stock: 18,
        description: "Invigorating body scrub with natural sea salt and essential oils for smooth, radiant skin."
      },
      {
        id: 20,
        name: "Argan Hair Mask",
        price: 42.00,
        originalPrice: 52.00,
        image: "../assets/images/product-08.jpg",
        category: "haircare",
        brand: "bio-essence",
        rating: 5,
        reviews: 1234,
        stock: 3,
        description: "Deep conditioning hair mask enriched with argan oil for intense hydration and repair.",
        onSale: true
      },
      {
        id: 21,
        name: "Citrus Burst Perfume",
        price: 76.00,
        image: "../assets/images/product-09.jpg",
        category: "perfume",
        brand: "natural-glow",
        rating: 4,
        reviews: 678,
        stock: 29,
        description: "Fresh and energizing citrus fragrance perfect for daily wear.",
        isNew: true
      },
      {
        id: 22,
        name: "Retinol Eye Cream",
        price: 54.00,
        image: "../assets/images/product-10.jpg",
        category: "skincare",
        brand: "glowing",
        rating: 5,
        reviews: 2156,
        stock: 11,
        description: "Gentle retinol eye cream that reduces dark circles and fine lines around the delicate eye area."
      },
      {
        id: 23,
        name: "Volumizing Shampoo",
        price: 26.00,
        image: "../assets/images/product-11.jpg",
        category: "haircare",
        brand: "bio-essence",
        rating: 4,
        reviews: 987,
        stock: 34,
        description: "Lightweight shampoo that adds volume and body to fine, limp hair."
      },
      {
        id: 24,
        name: "Makeup Brush Set",
        price: 48.00,
        originalPrice: 65.00,
        image: "../assets/images/product-01.jpg",
        category: "accessories",
        brand: "pure-skin",
        rating: 5,
        reviews: 1543,
        stock: 7,
        description: "Professional makeup brush set with synthetic bristles for flawless application.",
        onSale: true
      },
      {
        id: 25,
        name: "Hyaluronic Acid Serum",
        price: 39.00,
        image: "../assets/images/product-02.jpg",
        category: "skincare",
        brand: "glowing",
        rating: 5,
        reviews: 4567,
        stock: 22,
        description: "Intensive hydrating serum with multiple types of hyaluronic acid for plump, dewy skin."
      },
      {
        id: 26,
        name: "Coconut Hair Conditioner",
        price: 24.00,
        image: "../assets/images/product-03.jpg",
        category: "haircare",
        brand: "bio-essence",
        rating: 4,
        reviews: 1876,
        stock: 16,
        description: "Nourishing conditioner with coconut oil that softens and detangles hair."
      },
      {
        id: 27,
        name: "Vanilla Orchid Perfume",
        price: 94.00,
        image: "../assets/images/product-04.jpg",
        category: "perfume",
        brand: "natural-glow",
        rating: 5,
        reviews: 743,
        stock: 9,
        description: "Sophisticated fragrance with warm vanilla and exotic orchid notes.",
        isNew: true
      },
      {
        id: 28,
        name: "Jade Facial Roller",
        price: 22.00,
        image: "../assets/images/product-05.jpg",
        category: "accessories",
        brand: "pure-skin",
        rating: 4,
        reviews: 892,
        stock: 31,
        description: "Authentic jade facial roller for lymphatic drainage and improved circulation."
      },
      {
        id: 29,
        name: "Peptide Firming Cream",
        price: 72.00,
        originalPrice: 90.00,
        image: "../assets/images/product-06.jpg",
        category: "skincare",
        brand: "glowing",
        rating: 5,
        reviews: 2891,
        stock: 6,
        description: "Advanced firming cream with peptides and collagen boosters for youthful-looking skin.",
        onSale: true
      },
      {
        id: 30,
        name: "Keratin Hair Treatment",
        price: 58.00,
        image: "../assets/images/product-07.jpg",
        category: "haircare",
        brand: "bio-essence",
        rating: 5,
        reviews: 1654,
        stock: 14,
        description: "Professional-grade keratin treatment that smooths frizz and adds shine."
      },
      {
        id: 31,
        name: "Ocean Breeze Perfume",
        price: 68.00,
        image: "../assets/images/product-08.jpg",
        category: "perfume",
        brand: "natural-glow",
        rating: 4,
        reviews: 567,
        stock: 19,
        description: "Fresh aquatic fragrance that captures the essence of ocean waves and sea breeze."
      },
      {
        id: 32,
        name: "Gua Sha Stone Set",
        price: 18.00,
        image: "../assets/images/product-09.jpg",
        category: "accessories",
        brand: "pure-skin",
        rating: 4,
        reviews: 1234,
        stock: 28,
        description: "Traditional gua sha stones for facial massage and tension relief."
      },
      {
        id: 33,
        name: "Niacinamide Pore Serum",
        price: 35.00,
        image: "../assets/images/product-10.jpg",
        category: "skincare",
        brand: "glowing",
        rating: 5,
        reviews: 3456,
        stock: 13,
        description: "Pore-refining serum with niacinamide that minimizes appearance of large pores."
      },
      {
        id: 34,
        name: "Protein Hair Mask",
        price: 36.00,
        originalPrice: 45.00,
        image: "../assets/images/product-11.jpg",
        category: "haircare",
        brand: "bio-essence",
        rating: 5,
        reviews: 987,
        stock: 2,
        description: "Strengthening protein mask for damaged and chemically-treated hair.",
        onSale: true
      },
      {
        id: 35,
        name: "Lavender Dreams Perfume",
        price: 82.00,
        image: "../assets/images/product-01.jpg",
        category: "perfume",
        brand: "natural-glow",
        rating: 5,
        reviews: 654,
        stock: 17,
        description: "Calming lavender fragrance with hints of bergamot and white tea."
      },
      {
        id: 36,
        name: "LED Light Therapy Mask",
        price: 125.00,
        originalPrice: 150.00,
        image: "../assets/images/product-02.jpg",
        category: "accessories",
        brand: "pure-skin",
        rating: 5,
        reviews: 432,
        stock: 4,
        description: "Advanced LED light therapy mask for acne treatment and anti-aging benefits.",
        onSale: true,
        isNew: true
      }
    ];

    // Initialize products - Smart Merge
    let products = JSON.parse(localStorage.getItem('adminProducts')) || [];

    // Add missing defaults to the list
    DEFAULT_PRODUCTS.forEach(dp => {
      const exists = products.some(p => p.id === dp.id || (p.name === dp.name && p.category === dp.category));
      if (!exists) {
        products.push(dp);
      }
    });

    // Cleanup very old IDs (1, 2) if they are duplicates of new ones (13, 14)
    products = products.filter(p => p.id >= 10 || (p.id < 10 && !DEFAULT_PRODUCTS.some(dp => dp.name === p.name)));

    // Save immediately so it's ready for the first render
    localStorage.setItem('adminProducts', JSON.stringify(products));

    let orders = JSON.parse(localStorage.getItem('adminOrders')) || [];

    // Chart instances
    let revenueChart, statusChart, categoryChart;

    // Save data
    function saveData() {
      localStorage.setItem('adminUsers', JSON.stringify(users));
      localStorage.setItem('adminProducts', JSON.stringify(products));
      localStorage.setItem('adminOrders', JSON.stringify(orders));
      updateDashboard();
    }

    // Show section
    function showSection(section) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
      document.getElementById(section).classList.add('active');
      event.target.closest('.sidebar-link').classList.add('active');

      if (section === 'dashboard') loadDashboard();
      if (section === 'users') renderUsers();
      if (section === 'products') renderProducts();
      if (section === 'orders') renderOrders();
    }

    // ============ DASHBOARD FUNCTIONS ============

    function loadDashboard() {
      updateDashboardStats();
      loadRevenueChart();
      loadStatusChart();
      loadCategoryChart();
      loadRecentActivity();
      loadNotifications();
      loadTopProducts();
      loadRecentOrders();
    }

    function updateDashboard() {
      if (document.getElementById('dashboard').classList.contains('active')) {
        loadDashboard();
      }
    }

    function updateDashboardStats() {
      // Today's sales
      const today = new Date().toDateString();
      const todayOrders = orders.filter(o => new Date(o.date).toDateString() === today);
      const todaySales = todayOrders.reduce((sum, o) => sum + o.total, 0);
      document.getElementById('todaySales').textContent = `AED ${todaySales.toFixed(2)}`;

      // Total orders
      document.getElementById('totalOrders').textContent = orders.length;

      // Total customers
      document.getElementById('totalCustomers').textContent = users.length;

      // Low stock items
      const lowStock = products.filter(p => p.stock < 5);
      document.getElementById('lowStockItems').textContent = lowStock.length;

      // Monthly revenue
      const thisMonth = new Date().getMonth();
      const monthlyOrders = orders.filter(o => new Date(o.date).getMonth() === thisMonth);
      const monthlyRevenue = monthlyOrders.reduce((sum, o) => sum + o.total, 0);
      document.getElementById('monthlyRevenue').textContent = `AED ${monthlyRevenue.toFixed(2)}`;

      // Average order value
      const avgOrder = orders.length > 0 ? orders.reduce((sum, o) => sum + o.total, 0) / orders.length : 0;
      document.getElementById('avgOrderValue').textContent = `AED ${avgOrder.toFixed(2)}`;
    }

    function loadRevenueChart() {
      const ctx = document.getElementById('revenueChart');
      if (!ctx) return;

      // Destroy existing chart
      if (revenueChart) revenueChart.destroy();

      // Get last 7 days data
      const last7Days = [];
      const revenueData = [];

      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toDateString();
        last7Days.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));

        const dayOrders = orders.filter(o => new Date(o.date).toDateString() === dateStr);
        const dayRevenue = dayOrders.reduce((sum, o) => sum + o.total, 0);
        revenueData.push(dayRevenue);
      }

      revenueChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: last7Days,
          datasets: [{
            label: 'Revenue (AED)',
            data: revenueData,
            borderColor: '#5e8b61',
            backgroundColor: 'rgba(94, 139, 97, 0.1)',
            tension: 0.4,
            fill: true,
            borderWidth: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function (value) {
                  return 'AED ' + value;
                }
              }
            }
          }
        }
      });
    }

    function loadStatusChart() {
      const ctx = document.getElementById('statusChart');
      if (!ctx) return;

      if (statusChart) statusChart.destroy();

      // Count orders by status
      const statusCount = {
        pending: orders.filter(o => o.status === 'pending').length,
        processing: orders.filter(o => o.status === 'processing').length,
        shipped: orders.filter(o => o.status === 'shipped').length,
        delivered: orders.filter(o => o.status === 'delivered').length,
        cancelled: orders.filter(o => o.status === 'cancelled').length
      };

      statusChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Pending', 'Processing', 'Shipped', 'Delivered', 'Cancelled'],
          datasets: [{
            data: [statusCount.pending, statusCount.processing, statusCount.shipped, statusCount.delivered, statusCount.cancelled],
            backgroundColor: [
              '#f59e0b',
              '#3b82f6',
              '#8b5cf6',
              '#10b981',
              '#ef4444'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    function loadCategoryChart() {
      const ctx = document.getElementById('categoryChart');
      if (!ctx) return;

      if (categoryChart) categoryChart.destroy();

      // Calculate sales by category
      const categorySales = {};
      orders.forEach(order => {
        order.items.forEach(item => {
          const product = products.find(p => p.id === item.id);
          if (product) {
            const category = product.category;
            if (!categorySales[category]) {
              categorySales[category] = 0;
            }
            categorySales[category] += item.price * item.quantity;
          }
        });
      });

      const categories = Object.keys(categorySales);
      const sales = Object.values(categorySales);

      categoryChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: categories.map(c => c.charAt(0).toUpperCase() + c.slice(1)),
          datasets: [{
            label: 'Sales (AED)',
            data: sales,
            backgroundColor: [
              '#5e8b61',
              '#3b82f6',
              '#8b5cf6',
              '#f59e0b'
            ],
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function (value) {
                  return 'AED ' + value;
                }
              }
            }
          }
        }
      });
    }

    function loadRecentActivity() {
      const container = document.getElementById('recentActivity');
      if (!container) return;

      const activities = [];

      // Add order activities
      orders.slice(-5).reverse().forEach(order => {
        activities.push({
          type: 'order',
          icon: 'receipt-outline',
          iconClass: 'green',
          title: `New order #${order.id}`,
          description: `${order.customerName} placed an order`,
          time: getTimeAgo(new Date(order.date))
        });
      });

      // Add product activities
      products.slice(-3).reverse().forEach(product => {
        if (product.stock < 5) {
          activities.push({
            type: 'stock',
            icon: 'warning-outline',
            iconClass: 'orange',
            title: 'Low stock alert',
            description: `${product.name} - Only ${product.stock} left`,
            time: 'Today'
          });
        }
      });

      // Sort by relevance and limit to 6
      const recentActivities = activities.slice(0, 6);

      if (recentActivities.length === 0) {
        container.innerHTML = '<p style="text-align:center;padding:20px;color:var(--gray);">No recent activity</p>';
        return;
      }

      container.innerHTML = recentActivities.map(activity => `
        <div class="activity-item">
          <div class="activity-icon ${activity.iconClass}">
            <ion-icon name="${activity.icon}"></ion-icon>
          </div>
          <div class="activity-content">
            <div class="activity-title">${activity.title}</div>
            <div class="activity-description">${activity.description}</div>
            <div class="activity-time">${activity.time}</div>
          </div>
        </div>
      `).join('');
    }

    function loadNotifications() {
      const container = document.getElementById('notificationsPanel');
      if (!container) return;

      const notifications = [];

      // Low stock notifications
      const lowStock = products.filter(p => p.stock < 5);
      lowStock.forEach(product => {
        notifications.push({
          type: 'warning',
          icon: 'warning-outline',
          title: `Low Stock: ${product.name}`,
          message: `Only ${product.stock} items remaining in stock`
        });
      });

      // Pending orders
      const pendingOrders = orders.filter(o => o.status === 'pending');
      if (pendingOrders.length > 0) {
        notifications.push({
          type: 'info',
          icon: 'information-circle-outline',
          title: 'Pending Orders',
          message: `${pendingOrders.length} orders awaiting processing`
        });
      }

      // Out of stock
      const outOfStock = products.filter(p => p.stock === 0);
      if (outOfStock.length > 0) {
        notifications.push({
          type: 'danger',
          icon: 'close-circle-outline',
          title: 'Out of Stock',
          message: `${outOfStock.length} products are out of stock`
        });
      }

      if (notifications.length === 0) {
        container.innerHTML = '<p style="text-align:center;padding:20px;color:var(--gray);">No notifications</p>';
        return;
      }

      container.innerHTML = notifications.map(notif => `
        <div class="alert alert-${notif.type}">
          <ion-icon name="${notif.icon}"></ion-icon>
          <div>
            <strong>${notif.title}</strong><br>
            <small>${notif.message}</small>
          </div>
        </div>
      `).join('');
    }

    function loadTopProducts() {
      const container = document.getElementById('topProductsList');
      if (!container) return;

      // Calculate product revenue
      const productRevenue = {};
      const productSales = {};

      orders.forEach(order => {
        order.items.forEach(item => {
          if (!productRevenue[item.id]) {
            productRevenue[item.id] = 0;
            productSales[item.id] = 0;
          }
          productRevenue[item.id] += item.price * item.quantity;
          productSales[item.id] += item.quantity;
        });
      });

      // Sort products by revenue
      const topProducts = products
        .filter(p => productRevenue[p.id])
        .sort((a, b) => (productRevenue[b.id] || 0) - (productRevenue[a.id] || 0))
        .slice(0, 5);

      if (topProducts.length === 0) {
        container.innerHTML = '<p style="text-align:center;padding:20px;color:var(--gray);">No sales data yet</p>';
        return;
      }

      container.innerHTML = topProducts.map((product, index) => `
        <div class="top-product-item">
          <div class="product-info-inline">
            <div class="product-rank">${index + 1}</div>
            <img src="${product.image}" class="product-img" alt="${product.name}" onerror="this.src='../assets/images/product-01.jpg'">
            <div>
              <div style="font-weight: 600; color: var(--black);">${product.name}</div>
              <div style="font-size: 12px; color: var(--gray);">${product.category}</div>
            </div>
          </div>
          <div class="product-stats">
            <div class="product-revenue">AED ${(productRevenue[product.id] || 0).toFixed(2)}</div>
            <div class="product-sales">${productSales[product.id] || 0} sold</div>
          </div>
        </div>
      `).join('');
    }

    function loadRecentOrders() {
      const container = document.getElementById('recentOrdersTable');
      if (!container) return;

      const recentOrders = orders.slice(-5).reverse();

      if (recentOrders.length === 0) {
        container.innerHTML = '<p style="text-align:center;padding:20px;color:var(--gray);">No orders yet</p>';
        return;
      }

      container.innerHTML = `
        <table class="table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Date</th>
              <th>Total</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            ${recentOrders.map(order => `
              <tr onclick="viewOrderDetails(${order.id})" style="cursor: pointer;">
                <td>#${order.id}</td>
                <td>${order.customerName}</td>
                <td>${new Date(order.date).toLocaleDateString()}</td>
                <td>AED ${order.total.toFixed(2)}</td>
                <td><span class="badge badge-${order.status}">${order.status}</span></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);

      if (seconds < 60) return 'Just now';
      if (seconds < 3600) return Math.floor(seconds / 60) + ' minutes ago';
      if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
      if (seconds < 604800) return Math.floor(seconds / 86400) + ' days ago';
      return date.toLocaleDateString();
    }

    // ============ USERS FUNCTIONS ============

    function renderUsers() {
      const list = document.getElementById('usersList');
      list.innerHTML = `
        <table class="table">
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Role</th>
              <th>Joined</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${users.map(user => `
              <tr>
                <td>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <span class="user-avatar">${user.name.charAt(0)}</span>
                    ${user.name}
                  </div>
                </td>
                <td>${user.email}</td>
                <td><span class="badge badge-${user.role}">${user.role}</span></td>
                <td>${new Date(user.joined).toLocaleDateString()}</td>
                <td>
                  <button class="btn btn-secondary btn-sm" onclick="editUser(${user.id})">
                    <ion-icon name="create-outline"></ion-icon>
                    Edit
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="deleteUser(${user.id})">
                    <ion-icon name="trash-outline"></ion-icon>
                    Delete
                  </button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function showAddUser() {
      document.getElementById('usersList').style.display = 'none';
      document.getElementById('addUserForm').style.display = 'block';
    }

    function cancelUserForm() {
      document.getElementById('usersList').style.display = 'block';
      document.getElementById('addUserForm').style.display = 'none';
      document.getElementById('userName').value = '';
      document.getElementById('userEmail').value = '';
      document.getElementById('userRole').value = 'user';
    }

    function saveUser(e) {
      e.preventDefault();
      const newUser = {
        id: Date.now(),
        name: document.getElementById('userName').value,
        email: document.getElementById('userEmail').value,
        role: document.getElementById('userRole').value,
        joined: new Date().toISOString()
      };
      users.push(newUser);
      saveData();
      cancelUserForm();
      renderUsers();
      showNotification('User added successfully!');
    }

    function editUser(id) {
      const user = users.find(u => u.id === id);
      document.getElementById('usersList').style.display = 'none';
      document.getElementById('editUserForm').style.display = 'block';
      document.getElementById('editUserId').value = user.id;
      document.getElementById('editUserName').value = user.name;
      document.getElementById('editUserEmail').value = user.email;
      document.getElementById('editUserRole').value = user.role;
    }

    function cancelEditUser() {
      document.getElementById('usersList').style.display = 'block';
      document.getElementById('editUserForm').style.display = 'none';
    }

    function updateUser(e) {
      e.preventDefault();
      const id = parseInt(document.getElementById('editUserId').value);
      const index = users.findIndex(u => u.id === id);
      users[index].name = document.getElementById('editUserName').value;
      users[index].email = document.getElementById('editUserEmail').value;
      users[index].role = document.getElementById('editUserRole').value;
      saveData();
      cancelEditUser();
      renderUsers();
      showNotification('User updated successfully!');
    }

    function deleteUser(id) {
      if (confirm('Are you sure you want to delete this user?')) {
        users = users.filter(u => u.id !== id);
        saveData();
        renderUsers();
        showNotification('User deleted successfully!');
      }
    }

    function filterUsers() {
      const search = document.getElementById('userSearch').value.toLowerCase();
      // For simplicity, just re-render all users
      renderUsers();
    }

    // ============ PRODUCTS FUNCTIONS ============

    function renderProducts() {
      const list = document.getElementById('productsList');
      list.innerHTML = `
        <table class="table">
          <thead>
            <tr>
              <th>Product</th>
              <th>Price</th>
              <th>Category</th>
              <th>Stock</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${products.map(product => `
              <tr>
                <td>
                  <div style="display: flex; align-items: center; gap: 10px;">
                    <img src="${product.image}" class="product-img" alt="${product.name}" onerror="this.src='../assets/images/product-01.jpg'">
                    ${product.name}
                  </div>
                </td>
                <td>AED ${product.price.toFixed(2)}</td>
                <td>${product.category}</td>
                <td>${product.stock}</td>
                <td>
                  <button class="btn btn-secondary btn-sm" onclick="editProduct(${product.id})">
                    <ion-icon name="create-outline"></ion-icon>
                    Edit
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">
                    <ion-icon name="trash-outline"></ion-icon>
                    Delete
                  </button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function showAddProduct() {
      document.getElementById('productsList').style.display = 'none';
      document.getElementById('addProductForm').style.display = 'block';
    }

    function cancelProductForm() {
      document.getElementById('productsList').style.display = 'block';
      document.getElementById('addProductForm').style.display = 'none';
    }

    function saveProduct(e) {
      e.preventDefault();
      const newProduct = {
        id: Date.now(),
        name: document.getElementById('productName').value,
        price: parseFloat(document.getElementById('productPrice').value),
        originalPrice: parseFloat(document.getElementById('productOriginalPrice').value) || null,
        image: document.getElementById('productImage').value,
        category: document.getElementById('productCategory').value,
        brand: document.getElementById('productBrand').value,
        rating: parseInt(document.getElementById('productRating').value),
        reviews: parseInt(document.getElementById('productReviews').value),
        stock: parseInt(document.getElementById('productStock').value),
        description: document.getElementById('productDescription').value
      };
      products.push(newProduct);
      saveData();
      cancelProductForm();
      renderProducts();
      showNotification('Product added successfully!');
    }

    function editProduct(id) {
      showNotification('Edit product feature - coming soon!');
    }

    function deleteProduct(id) {
      if (confirm('Are you sure you want to delete this product?')) {
        products = products.filter(p => p.id !== id);
        saveData();
        renderProducts();
        showNotification('Product deleted successfully!');
      }
    }

    function filterProducts() {
      renderProducts();
    }

    // ============ ORDERS FUNCTIONS ============

    function renderOrders() {
      const list = document.getElementById('ordersList');
      if (orders.length === 0) {
        list.innerHTML = '<p style="text-align:center;padding:40px;color:#999;">No orders yet.</p>';
        return;
      }
      list.innerHTML = `
        <table class="table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>Customer</th>
              <th>Date</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${orders.map(order => `
              <tr>
                <td>#${order.id}</td>
                <td>${order.customerName}</td>
                <td>${new Date(order.date).toLocaleDateString()}</td>
                <td>${order.items.length} items</td>
                <td>AED ${order.total.toFixed(2)}</td>
                <td><span class="badge badge-${order.status}">${order.status}</span></td>
                <td>
                  <select class="btn btn-sm" onchange="updateOrderStatus(${order.id}, this.value)" style="padding: 6px 10px;">
                    <option value="">Change Status</option>
                    <option value="pending">Pending</option>
                    <option value="processing">Processing</option>
                    <option value="shipped">Shipped</option>
                    <option value="delivered">Delivered</option>
                    <option value="cancelled">Cancelled</option>
                  </select>
                  <button class="btn btn-secondary btn-sm" onclick="viewOrderDetails(${order.id})">
                    <ion-icon name="eye-outline"></ion-icon>
                    View
                  </button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    function updateOrderStatus(orderId, newStatus) {
      if (!newStatus) return;
      const order = orders.find(o => o.id === orderId);
      if (order) {
        order.status = newStatus;
        saveData();
        renderOrders();
        showNotification(`Order #${orderId} status updated to ${newStatus}!`);
      }
    }

    function viewOrderDetails(orderId) {
      const order = orders.find(o => o.id === orderId);
      if (!order) return;

      const details = `
Order ID: #${order.id}
Customer: ${order.customerName}
Email: ${order.customerEmail}
Phone: ${order.customerPhone}
Address: ${order.shippingAddress}
Date: ${new Date(order.date).toLocaleString()}
Status: ${order.status}
Total: AED ${order.total.toFixed(2)}

Items:
${order.items.map((item, i) => `${i + 1}. ${item.name} - Qty: ${item.quantity} - AED ${(item.price * item.quantity).toFixed(2)}`).join('\n')}
      `;

      alert(details);
    }


    function filterOrders() {
      renderOrders();
    }

    // ============ UTILITY FUNCTIONS ============

    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => document.body.removeChild(notification), 300);
      }, 3000);
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        window.location.href = '../../index.html';
      }
    }

    function checkForNewOrders() {
      console.log('ðŸ”„ === SYNCING DATA ===');

      // 1. Sync Orders
      const checkoutOrders = JSON.parse(localStorage.getItem('orders')) || [];
      const existingAdminOrders = JSON.parse(localStorage.getItem('adminOrders')) || [];

      checkoutOrders.forEach(checkoutOrder => {
        const exists = orders.find(o => o.id === checkoutOrder.id);
        if (!exists) {
          orders.push(checkoutOrder);
        }
      });

      existingAdminOrders.forEach(adminOrder => {
        const exists = orders.find(o => o.id === adminOrder.id);
        if (!exists) {
          orders.push(adminOrder);
        }
      });

      // 2. Sync Users
      const savedUsers = JSON.parse(localStorage.getItem('adminUsers')) || [];
      savedUsers.forEach(savedUser => {
        const exists = users.find(u => u.id === savedUser.id);
        if (!exists) {
          users.push(savedUser);
        }
      });

      // 3. Sync Products
      const savedProducts = JSON.parse(localStorage.getItem('adminProducts')) || [];
      savedProducts.forEach(savedProduct => {
        const exists = products.find(p => p.id === savedProduct.id);
        if (!exists) {
          products.push(savedProduct);
        }
      });

      console.log('âœ… Sync complete');
      saveData();
    }

    // ============ INITIALIZATION ============

    document.addEventListener('DOMContentLoaded', function () {
      console.log('=== ADMIN PANEL LOADING ===');

      // Force reload users from localStorage
      const savedUsers = JSON.parse(localStorage.getItem('adminUsers')) || [];
      if (savedUsers.length > 0) {
        console.log('ðŸ“¥ Loading', savedUsers.length, 'users from localStorage');
        users = savedUsers;
      }

      // Force reload orders
      const savedOrders = JSON.parse(localStorage.getItem('adminOrders')) || [];
      if (savedOrders.length > 0) {
        console.log('ðŸ“¥ Loading', savedOrders.length, 'orders from localStorage');
        orders = savedOrders;
      }

      // Force reload products
      const savedProducts = JSON.parse(localStorage.getItem('adminProducts')) || [];
      if (savedProducts.length > 0) {
        console.log('ðŸ“¥ Loading', savedProducts.length, 'products from localStorage');
        products = savedProducts;
      }

      console.log('âœ… Initial load complete');
      console.log('ðŸ‘¥ Users:', users.length);
      console.log('ðŸ“¦ Orders:', orders.length);
      console.log('ðŸ·ï¸ Products:', products.length);

      // Check for new data
      checkForNewOrders();

      // Load dashboard
      loadDashboard();
    });

    // Keep the periodic sync
    setInterval(checkForNewOrders, 5000);

  </script>
</body>

</html>